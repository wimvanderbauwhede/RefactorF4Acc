module singleton_module_src_papi

contains

      real function dnekgflops()
      implicit none
      real(kind=4) :: mflops
      integer(kind=8) :: flpops
      call getflops_papi(flpops,mflops)
      dnekgflops = mflops/1e3
      return
      end function dnekgflops
      subroutine getflops_papi(flpops,mflops)
#ifdef PAPI
      implicit none
      integer, parameter :: papi_null=-1
      integer, parameter :: papi_ver_current=84344832
      integer, parameter :: papi_version=84345088
      integer, parameter :: papi_max_preset_events=128
      integer, parameter :: papi_not_inited=0
      integer, parameter :: papi_low_level_inited=1
      integer, parameter :: papi_high_level_inited=2
      integer, parameter :: papi_thread_level_inited=4
      integer, parameter :: papi_dom_user=1
      integer, parameter :: papi_dom_kernel=2
      integer, parameter :: papi_dom_other=4
      integer, parameter :: papi_dom_supervisor=8
      integer, parameter :: papi_dom_all=15
      integer, parameter :: papi_dom_min=1
      integer, parameter :: papi_dom_max=15
      complex, parameter :: papi_dom_hwspec=((-2147483647)-1)
      integer, parameter :: papi_stopped=1
      integer, parameter :: papi_running=2
      integer, parameter :: papi_paused=4
      integer, parameter :: papi_not_init=8
      integer, parameter :: papi_overflowing=16
      integer, parameter :: papi_profiling=32
      integer, parameter :: papi_multiplexing=64
      integer, parameter :: papi_attached=128
      integer, parameter :: papi_cpu_attached=256
      integer, parameter :: papi_quiet=0
      integer, parameter :: papi_verb_econt=1
      integer, parameter :: papi_verb_estop=2
      integer, parameter :: papi_min_str_len=64
      integer, parameter :: papi_huge_str_len=1024
      integer, parameter :: papi_max_str_len=128
      integer, parameter :: papi_num_errors=26
      integer, parameter :: papi_multiplex_default=0
      integer, parameter :: papi_multiplex_force_sw=1
      integer, parameter :: papi_debug=2
      integer, parameter :: papi_multiplex=3
      integer, parameter :: papi_defdom=4
      integer, parameter :: papi_domain=5
      integer, parameter :: papi_defgrn=6
      integer, parameter :: papi_granul=7
      integer, parameter :: papi_def_mpx_ns=8
      integer, parameter :: papi_max_mpx_ctrs=11
      integer, parameter :: papi_profil=12
      integer, parameter :: papi_preload=13
      integer, parameter :: papi_clockrate=14
      integer, parameter :: papi_max_hwctrs=15
      integer, parameter :: papi_hwinfo=16
      integer, parameter :: papi_exeinfo=17
      integer, parameter :: papi_max_cpus=18
      integer, parameter :: papi_attach=19
      integer, parameter :: papi_shlibinfo=20
      integer, parameter :: papi_lib_version=21
      integer, parameter :: papi_componentinfo=22
      integer, parameter :: papi_detach=1
      integer, parameter :: papi_grn_thr=1
      integer, parameter :: papi_grn_min=1
      integer, parameter :: papi_grn_proc=2
      integer, parameter :: papi_grn_procg=4
      integer, parameter :: papi_grn_sys=8
      integer, parameter :: papi_grn_sys_cpu=16
      integer, parameter :: papi_grn_max=16
      integer, parameter :: papi_derived=1
      integer, parameter :: papi_profil_posix=0
      integer, parameter :: papi_profil_random=1
      integer, parameter :: papi_profil_weighted=2
      integer, parameter :: papi_profil_compress=4
      integer, parameter :: papi_profil_bucket_16=8
      integer, parameter :: papi_profil_bucket_32=16
      integer, parameter :: papi_profil_bucket_64=32
      integer, parameter :: papi_usr1_lock=0
      integer, parameter :: papi_usr2_lock=1
      integer, parameter :: papi_lock_usr1=0
      integer, parameter :: papi_lock_usr2=1
      integer, parameter :: papi_lock_num=2
      integer, parameter :: papi_mh_max_levels=6
      integer, parameter :: papi_usr1_tls=0
      integer, parameter :: papi_usr2_tls=1
      integer, parameter :: papi_tls_usr1=0
      integer, parameter :: papi_tls_usr2=1
      integer, parameter :: papi_tls_high_level=2
      integer, parameter :: papi_tls_num=3
      integer, parameter :: papif_dmem_vmsize=2
      integer, parameter :: papif_dmem_resident=3
      integer, parameter :: papif_dmem_high_water=4
      integer, parameter :: papif_dmem_shared=5
      integer, parameter :: papif_dmem_text=6
      integer, parameter :: papif_dmem_library=7
      integer, parameter :: papif_dmem_heap=8
      integer, parameter :: papif_dmem_locked=9
      integer, parameter :: papif_dmem_stack=10
      integer, parameter :: papif_dmem_pagesize=11
      integer, parameter :: papif_dmem_maxval=12
      integer, parameter :: papi_ok=0
      integer, parameter :: papi_einval=-1
      integer, parameter :: papi_enomem=-2
      integer, parameter :: papi_esys=-3
      integer, parameter :: papi_ecmp=-4
      integer, parameter :: papi_eclost=-5
      integer, parameter :: papi_ebug=-6
      integer, parameter :: papi_enoevnt=-7
      integer, parameter :: papi_ecnflct=-8
      integer, parameter :: papi_enotrun=-9
      integer, parameter :: papi_eisrun=-10
      integer, parameter :: papi_enoevst=-11
      integer, parameter :: papi_enotpreset=-12
      integer, parameter :: papi_enocntr=-13
      integer, parameter :: papi_emisc=-14
      integer, parameter :: papi_eperm=-15
      integer, parameter :: papi_enoinit=-16
      integer, parameter :: papi_enocmp=-17
      integer, parameter :: papi_enosupp=-18
      integer, parameter :: papi_enoimpl=-19
      integer, parameter :: papi_ebuf=-20
      integer, parameter :: papi_einval_dom=-21
      integer, parameter :: papi_eattr=-22
      integer, parameter :: papi_ecount=-23
      integer, parameter :: papi_ecombo=-24
      integer, parameter :: papi_ecmp_disabled=-25
      complex, parameter :: papi_l1_dcm=((-2147483647)-1)
      integer, parameter :: papi_l1_icm=-2147483647
      integer, parameter :: papi_l2_dcm=-2147483646
      integer, parameter :: papi_l2_icm=-2147483645
      integer, parameter :: papi_l3_dcm=-2147483644
      integer, parameter :: papi_l3_icm=-2147483643
      integer, parameter :: papi_l1_tcm=-2147483642
      integer, parameter :: papi_l2_tcm=-2147483641
      integer, parameter :: papi_l3_tcm=-2147483640
      integer, parameter :: papi_ca_snp=-2147483639
      integer, parameter :: papi_ca_shr=-2147483638
      integer, parameter :: papi_ca_cln=-2147483637
      integer, parameter :: papi_ca_inv=-2147483636
      integer, parameter :: papi_ca_itv=-2147483635
      integer, parameter :: papi_l3_ldm=-2147483634
      integer, parameter :: papi_l3_stm=-2147483633
      integer, parameter :: papi_bru_idl=-2147483632
      integer, parameter :: papi_fxu_idl=-2147483631
      integer, parameter :: papi_fpu_idl=-2147483630
      integer, parameter :: papi_lsu_idl=-2147483629
      integer, parameter :: papi_tlb_dm=-2147483628
      integer, parameter :: papi_tlb_im=-2147483627
      integer, parameter :: papi_tlb_tl=-2147483626
      integer, parameter :: papi_l1_ldm=-2147483625
      integer, parameter :: papi_l1_stm=-2147483624
      integer, parameter :: papi_l2_ldm=-2147483623
      integer, parameter :: papi_l2_stm=-2147483622
      integer, parameter :: papi_btac_m=-2147483621
      integer, parameter :: papi_prf_dm=-2147483620
      integer, parameter :: papi_l3_dch=-2147483619
      integer, parameter :: papi_tlb_sd=-2147483618
      integer, parameter :: papi_csr_fal=-2147483617
      integer, parameter :: papi_csr_suc=-2147483616
      integer, parameter :: papi_csr_tot=-2147483615
      integer, parameter :: papi_mem_scy=-2147483614
      integer, parameter :: papi_mem_rcy=-2147483613
      integer, parameter :: papi_mem_wcy=-2147483612
      integer, parameter :: papi_stl_icy=-2147483611
      integer, parameter :: papi_ful_icy=-2147483610
      integer, parameter :: papi_stl_ccy=-2147483609
      integer, parameter :: papi_ful_ccy=-2147483608
      integer, parameter :: papi_hw_int=-2147483607
      integer, parameter :: papi_br_ucn=-2147483606
      integer, parameter :: papi_br_cn=-2147483605
      integer, parameter :: papi_br_tkn=-2147483604
      integer, parameter :: papi_br_ntk=-2147483603
      integer, parameter :: papi_br_msp=-2147483602
      integer, parameter :: papi_br_prc=-2147483601
      integer, parameter :: papi_fma_ins=-2147483600
      integer, parameter :: papi_tot_iis=-2147483599
      integer, parameter :: papi_tot_ins=-2147483598
      integer, parameter :: papi_int_ins=-2147483597
      integer, parameter :: papi_fp_ins=-2147483596
      integer, parameter :: papi_ld_ins=-2147483595
      integer, parameter :: papi_sr_ins=-2147483594
      integer, parameter :: papi_br_ins=-2147483593
      integer, parameter :: papi_vec_ins=-2147483592
      integer, parameter :: papi_res_stl=-2147483591
      integer, parameter :: papi_fp_stal=-2147483590
      integer, parameter :: papi_tot_cyc=-2147483589
      integer, parameter :: papi_lst_ins=-2147483588
      integer, parameter :: papi_syc_ins=-2147483587
      integer, parameter :: papi_l1_dch=-2147483586
      integer, parameter :: papi_l2_dch=-2147483585
      integer, parameter :: papi_l1_dca=-2147483584
      integer, parameter :: papi_l2_dca=-2147483583
      integer, parameter :: papi_l3_dca=-2147483582
      integer, parameter :: papi_l1_dcr=-2147483581
      integer, parameter :: papi_l2_dcr=-2147483580
      integer, parameter :: papi_l3_dcr=-2147483579
      integer, parameter :: papi_l1_dcw=-2147483578
      integer, parameter :: papi_l2_dcw=-2147483577
      integer, parameter :: papi_l3_dcw=-2147483576
      integer, parameter :: papi_l1_ich=-2147483575
      integer, parameter :: papi_l2_ich=-2147483574
      integer, parameter :: papi_l3_ich=-2147483573
      integer, parameter :: papi_l1_ica=-2147483572
      integer, parameter :: papi_l2_ica=-2147483571
      integer, parameter :: papi_l3_ica=-2147483570
      integer, parameter :: papi_l1_icr=-2147483569
      integer, parameter :: papi_l2_icr=-2147483568
      integer, parameter :: papi_l3_icr=-2147483567
      integer, parameter :: papi_l1_icw=-2147483566
      integer, parameter :: papi_l2_icw=-2147483565
      integer, parameter :: papi_l3_icw=-2147483564
      integer, parameter :: papi_l1_tch=-2147483563
      integer, parameter :: papi_l2_tch=-2147483562
      integer, parameter :: papi_l3_tch=-2147483561
      integer, parameter :: papi_l1_tca=-2147483560
      integer, parameter :: papi_l2_tca=-2147483559
      integer, parameter :: papi_l3_tca=-2147483558
      integer, parameter :: papi_l1_tcr=-2147483557
      integer, parameter :: papi_l2_tcr=-2147483556
      integer, parameter :: papi_l3_tcr=-2147483555
      integer, parameter :: papi_l1_tcw=-2147483554
      integer, parameter :: papi_l2_tcw=-2147483553
      integer, parameter :: papi_l3_tcw=-2147483552
      integer, parameter :: papi_fml_ins=-2147483551
      integer, parameter :: papi_fad_ins=-2147483550
      integer, parameter :: papi_fdv_ins=-2147483549
      integer, parameter :: papi_fsq_ins=-2147483548
      integer, parameter :: papi_fnv_ins=-2147483547
      integer, parameter :: papi_fp_ops=-2147483546
      integer, parameter :: papi_sp_ops=-2147483545
      integer, parameter :: papi_dp_ops=-2147483544
      integer, parameter :: papi_vec_sp=-2147483543
      integer, parameter :: papi_vec_dp=-2147483542
      integer, parameter :: papi_ref_cyc=-2147483541
      real(kind=4) :: rtime
      real(kind=4) :: ptime
      real(kind=4), intent(InOut) :: mflops
      integer(kind=8), intent(InOut) :: flpops
      call papif_flops(rtime,ptime,flpops,mflops,ierr)
      if(ierr /= 0) then
        flpops = -1
        mflops = -1
      endif
#else
      flpops = -1
      mflops = -0
#endif
      return
      end subroutine getflops_papi

end module singleton_module_src_papi

