With the current version, the failing tests are 
FM406 test 3
FM923 tests 22 and 23, these tests also fail in the original code with gfortran.

New failures:

FM302.res:                        3 TESTS FAILED

The original version, compiled with gfortran 9.4 and also gfortran 13.1, has 2 failed tests, 4 and 14; the refactored version also fails test 13

!      ****  FCVS PROGRAM 302  -  TEST 013  ****                         
!                                                                        
!           TEST 013 IS DESIGNED TO TEST THE EXTENSION OF NAMED COMMON   
!      BLOCK STORAGE BY EQUIVALENCE ASSOCIATION OF A VARIABLE AND AN     
!      ARRAY.  



The missing bit is that, if we currently something like 

(a2) = ...
v1 = a1(1)

res = f(v1,vc1)

where vc1 is an ex-glob that comes right after v1

then it should be

(a2) = ...
vc1 = a1(2)

res = f(v1,vc1)

instead

So what we should do is 
detect that 
(1) there is an equivalence between an array and a scalar
(2) the scalar is in a common block
(3) that common block is extended in a function or subroutine that is called in the code unit where it is defined

